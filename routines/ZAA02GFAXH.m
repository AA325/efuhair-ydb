ZAA02GFAXH ;PG&A,ZAA02G-FAX,1.36,MH ENCODING;17MAY96 8:40A [ 08/22/96   9:33 AM ];;;21APR2006  15:18
 ;Copyright (C) 1991-1994, Patterson, Gray and Associates Inc.
 ;
 D INIT,INIT1 X:$P(B,"\",34)'="" $P(B,"\",34) G ^ZAA02GFAXH1
 ;
INIT S ZAA02GWPD=ZAA02GFAXD,DVP="\\\\P" D @$S('$D(@ZAA02GWPD@(.015)):"S2^ZAA02GFAXU",^(.015)="VT220":"S3^ZAA02GFAXU",1:"REVERS^ZAA02GWPPC1") S XL=ZAA02G("uo")_ZAA02G("uf")_ZAA02G("ron")_ZAA02G("rof")
 I $G(^ZAA02GFAXC(99))]"" S MD=^(99),CB=$S(MD="G":$C(169,142,153,154,96,132,148,129,225),MD="F":$C(133,248,135,169,96,130,151,138,126),MD="I":$C(169,248,135,130,151,133,149,138,141),1:" "),CA=$C(64,91,92,93,96,123,124,125,126)
 S:'$D(CA) (CA,CB)=" " S:'$D(CD) (CD,CE)=" "
 S A=^ZAA02GFAXC("CONFIG"),MG=$S($P(A,"\",5)]"":$P(A,"\",5),1:1)*204\1,TP=$S($P(A,"\",4)]"":$P(A,"\",4),1:1),(SPGL,PGL)=$S($P(A,"\",6)]"":$P(A,"\",6),1:11)-TP-.6*97.8
 S FNT=$S($D(@ZAA02GFAXD@(.01)):^(.01)<100*20+10,1:30) I $P(B,"\",19)?1A S E=$P(B,"\",19) D GRF^ZAA02GFAXH1
 Q
INIT1 S EOL=^ZAA02GFAXC(0,2,0),(XSF,FXL,TFXL,CVR)=0,PG=1,TRL="" K CVRP,MF,TR
 I '$D(wht) F I=0:1:32 S wht(I)=^ZAA02GFAXC(0,0,I)
 I '$D(AL) S AL="" F I=32:2:254 S AL=AL_$C(I,I+1)
 S X="" F I=1:1:16 S X=$O(^ZAA02GFAXC(0,3,X)),D=$A(^(X))\16 S B($E(X,5,8))=D,C($E(X,5,8))=D*16
 Q
 ;
DT D TDATE^ZAA02GFAXU,INIT1 S MG=98,FNT=10,XS=$C(27),(CA,CB)=" ",PGL=900 D GETFNT^ZAA02GFAXH1
 F SN=1:1:$L(JB,",")-1 S JOB=$P(JB,",",SN),SJB(JOB)=0,NP=+$P($G(^ZAA02GFAXI(JOB)),",",3),ZAA02GFAXS="^ZAA02GFAXI(JOB,0)" F PG=1:1:NP S TXT=DT_"  "_TM_"  #"_JOB_"   "_PG_"/"_NP,(FXL,CVR)=0 D LINE^ZAA02GFAXH1
 Q
 ;
COMP F I=0:1:60 S wht(I)=^ZAA02GFAXC(0,0,I),blk(I)=^ZAA02GFAXC(0,1,I)
 F C=0:1:255 S X=^ZAA02GFAXC(0,4,C) D COMPL S ^ZAA02GFAXC(.8,C)=Y
 Q
COMPL S Y="",D=1
CMPL1 S (L,M)=$F(X,1,D) S:L=0 L=$L(X)+2 S L=L-D-1 S:L<1 L=0 S Y=Y_$S(Y="":L,M:wht(L),1:","_L),W=D+L
 I W'>$L(X) S L=$F(X,0,W) S:L=0 L=$L(X)+2 S L=L-W-1,Y=Y_$S(Y[",":"",1:",")_blk(L),D=W+L G CMPL1
 Q
FONT S FNTI=FNT\10*10,FR=+^ZAA02GFAXF(FNTI) F I=1:1:FR S ^ZAA02GFAXF(FNTI,.7,I)="",^ZAA02GFAXF(FNTI,.8,I)=""
 F CH=32:1:$L($G(^ZAA02GFAXF(FNTI,.1,1)))+30 D DSP
 Q
DSP F R=1:1:FR S X=$S($D(^ZAA02GFAXF(FNT,.2,R)):$A(^(R),CH-31)*256+$A(^ZAA02GFAXF(FNT,.1,R),CH-31),$D(^ZAA02GFAXF(FNT,.1,R)):$A(^(R),CH-31),1:0) D DSP1 S X=$TR(X," X","01") D DSP2 ; W X,!
 Q
DSP1 I 'X S X=$J("",FC) Q
 S W=0,X1=^ZAA02GFAXF(FNTI,.3,X) I X1?.N S X=$J("",X1) Q
 S X=$P(X1,",",2),ZZ=0,Y="",(Y1,Y2)=0 D DECODE^ZAA02GFAXD S X=$J("",+X1) F K=1:1:$L(Y,"+") S:K#2 X=X_$E("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",1,+$P(Y,"+",K)) S:K#2=0 X=X_$J("",+$P(Y,"+",K))
 S X=X_$J("",$P(X1,",",3)) Q
DSP2 S ^ZAA02GFAXF(FNTI,.7,R)=^ZAA02GFAXF(FNTI,.7,R)_^ZAA02GFAXC(0,3,$E(X,1,8)),^ZAA02GFAXF(FNTI,.8,R)=^ZAA02GFAXF(FNTI,.8,R)_^ZAA02GFAXC(0,3,$E(X_"00000000",9,16)) Q
 ;
CONV ; CONVERTS STANDARD FAX GRAPHIC TO TRANSPARENT
 R "GRAPHIC-",GR,! D CRINT S G="^ZAA02GFAXS("""_GR_""")" K ^ZAA02GTFAX($I)
 S KA="" F KK=1:1 S KA=$O(@G@(KA)) Q:'KA  S Y1=0,AA=^(KA)_$C(0),(ZZ,Z,Y2)=0,(X,Y)="",W=1 I AA'="" D P2^ZAA02GFAXD S:Y]"" Y1=Y1+1,Y(Y1)=Y W "." S ^ZAA02GTFAX($I,KK)=Y(1) F Y=2:1:Y1 S ^ZAA02GTFAX($I,KK,Y-1)=Y(Y)
 S TZAA02G=KK-1
CONV1 S LM=2000,E=0 F KK=1:1:TZAA02G S A=^ZAA02GTFAX($I,KK),B="B="_A,@B S:$D(^(KK,1)) B="B="_B_"+"_^(1),@B S:$D(^(2)) B="B="_B_"+"_^(2),@B S:B'=1728 E=KK S:A<LM LM=+A
 I E W "ERROR IN-",E Q
 W "LEFT MARGIN=",LM,! H 2
 F KK=1:1:TZAA02G S (X2,X1)="",X="X0",X0=^ZAA02GTFAX($I,KK) S:$D(^(KK,1)) X="X1",X1=^(1) S:$D(^(2)) X="X2",X2=^(2) W KK,?10,"X0=",X0,!,"X1=",X1,!,"X2=",X2,! D CONV2 W ?5,W,?10,X0,!
 Q
CONV2 S $P(X0,"+")=X0-LM,B=$L(@X,"+")-2,@X=$P(@X,"+",1,B) S:B<1 B=1 S $P(@X,"+",B)=$P(@X,"+",B)+0 I X'[0 S B=$L(X0,"+"),X0=$P(X0,"+",1,B-1) S:X[2 B=$L(X1,"+"),X1=$P(X1,"+",1,B-1)
 S B="W="_X0,@B S:X1]"" B="W="_W_"+"_X1,@B S:X2]"" B="W="_W_"+"_X2,@B S (LX,L)=""
 I X0["+" F XX=0,1,2 S X=@("X"_XX) I X]"" F I=1:1:$L(X,"+") S Y=$P(X,"+",I) S:I#2 L=L_$S(Y<64:wht(Y),1:^ZAA02GFAXC(0,0,Y\64*64)_^(Y#64)) S:I#2=0 L=L_$S(Y<64:blk(Y),1:^ZAA02GFAXC(0,1,Y\64*64)_^(Y#64)) D:$L(L)>16 LF
 D LS S ^ZAA02GFAXO(GR,KK)=W_";;;"_L_";"_LX
CONV3 S LX="",L="" I $L(X0,"+")>1
 I  F XX=0,1,2 S X=@("X"_XX) I X]"" F I=1:1:$L(X,"+") S Y=$P(X,"+",I) F M=1:1:Y-1\32+1 S D=$S(Y<32:Y,1:32),Y=Y-32,L=L_$S(I#2:$E("000000000000000000000000000000000",1,D),1:$E("1111111111111111111111111111111111",1,D)) D:$L(L)>16 LF D:$L(L)>16 LF
 S L=L_$E("00000000",1,-$L(L)#8) D LS S (L,R)="" F J=1:2:$L(LX) S L=L_$E(LX,J),R=R_$E(LX,J+1)
 S:$L(L)>$L(R) R=R_$C(0) S ^ZAA02GFAXO(GR,KK,1)=L,^(2)=R Q
 Q
 ;
CONV4 N (Y1,LX,X0,X1,X2) S AA=LX,(ZZ,Z,Y2,Y1)=0,(X,Y,X0,X1,X2)="",W=1 I AA'="" S AA=AA_$C(0) D P4^ZAA02GFAXD S X0=Y S:Y1>0 X0=Y(1),X1=Y S:Y1=2 X1=Y(2),X2=Y
 Q
CONVO R "OVR-",GR,! D CRINT S G="^ZAA02GFAXO("""_GR_""")" F KK=1:1 Q:$D(@G@(KK))=0  S AA=^(KK),LX=$P(AA,";",5,99),L=$P(AA,";",4),L=L_$E("00000000",1,-$L(L)#8) D LS D CONV4 W "." D CONV3
 Q
LF S LX=LX_$C(B($E(L,1,4))+C($E(L,5,8)))_$C(B($E(L,9,12))+C($E(L,13,16))),L=$E(L,17,255) Q
LS F i=1:8:$L(L)\8*8 S LX=LX_$C(B($E(L,i,i+3))+C($E(L,i+4,i+7)))
 S L=$E(L,$L(L)>7*(i+8),255) Q
CRINT S X="" F I=1:1:16 S X=$O(^ZAA02GFAXC(0,3,X)),D=$A(^(X))\16 S B($E(X,5,8))=D,C($E(X,5,8))=D*16
 S AL="" F I=32:2:254 S AL=AL_$C(I,I+1)
 F I=0:1:63 S wht(I)=^ZAA02GFAXC(0,0,I),blk(I)=^ZAA02GFAXC(0,1,I)
 Q
