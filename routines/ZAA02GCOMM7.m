ZAA02GCOMM7 ;PG&A,ZAA02G-COMM,1.36,MODEM TRANSFER (SCRIPT CONTROL);29SEP95 12:30P;;;05MAR98  14:18
 ;PG&A, 1984
EDIT S %R=3,%C=1 W @ZAA02GP,ZAA02G("CS")
 D EDT1 S Y(Y+1)="(new entry)",YY(Y+1)="" D EDS G END:X="",END:'$D(YY(X)) S SCR=YY(X) I SCR="" D EDTC G:SCR="" END S @ZAA02GCOMMG@("SCR",SCR)=X
 S %R=4,%C=36-($L(SCR)\2) W @ZAA02GP,"SCRIPT: ",SCR
 S TL=7,BL=22,WO="",MG=60,ZAA02GWPD="@ZAA02GCOMMG@(""SCR"",SCR)",NM=SCR,ZAA02GWPOPT="ST,OT2,5,8,9,18",HLPR="^ZAA02GCOMMH"
 D ENTRY^ZAA02GWPV6 S A=.03 K Y,XX,HLPR S Y=0 F J=1:1 S A=$O(@ZAA02GCOMMG@("SCR",SCR,A)) Q:A=""  S B=^(A) I $E(B,1,3)'="REM",$E(B)'=";" D:B'="" CHK
 I J=1 K @ZAA02GCOMMG@("SCR",SCR) G END
 I $D(Y)>1 S %R=6,%C=1 W @ZAA02GP,Y," ERROR",$S(Y>1:"S",1:"")," ENCOUNTERED IN SCRIPT",!!,"LINE",?10,"COMMAND",?50,"ERROR",!,"------    ------------------------------------    ---------------------",!
 I  S A="" F J=1:1 S A=$O(Y(A)) Q:A=""  W A,?10,$E($P(Y(A),$C(0)),1,38),?50,$P(Y(A),$C(0),2),!
 I  W !,"PRESS RETURN" R C#1
END G T4^ZAA02GCOMM1
 ;
CHK S C=$TR($P(B,"-"),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ"),K=0 I B["-"
 I  F K=1:1:26 I $P("SEND,WAIT FOR,SET WAIT,SET DELAY,SET BAUD,GOTO,ELSE GOTO,IF GOTO,RUN,REPORT,SET DEVICE,SET FILTER,SET DEVICE,SET FLAG,SKERMIT,RKERMIT,SASCII,RASCII,PAUSE,CAPTURE ON,OPTION,SGLOBAL,RGLOBAL,SROUTINE,X",",",K)=C Q
 I K=26 S Y(J)=B_$C(0)_"INVALID COMMAND",Y=Y+1 Q
 Q:K  I B?1.AN1":" Q
 X "F K=1:1:19 I $P(""TERM ON,CAPTURE ON,CAPTURE OFF,END,TRACE ON,TRACE OFF,QUIET ON,QUIET OFF,CLEAR,X,X,X,X,X,X,X,X,X,X,X,X,X"","","",K)=C Q" S:K=19 Y(J)=B_$C(0)_"INVALID COMMAND",Y=Y+1 Q
 Q
EDS S Y="20,8\RHLY\1\ZAA02G-COMM SCRIPT LIST",Y(0)="\EX" D ^ZAA02GPOP S:X["EX" X="" K Y Q
 ;
EDT1 K Y S Y=0,A="" F J=1:1 S A=$O(@ZAA02GCOMMG@("SCR",A)) Q:A=""  S Y=Y+1,Y(Y)=A_$J("",20-$L(A))_^(A),YY(Y)=A
 Q
EDTC S Y="25,12\LHD\1\ SCRIPT DEFINITION *\\*,Enter Script Name - *            ",X="" K LNG,PAT,TRM,CHR D ^ZAA02GPOP S SCR=X Q:X=""
 S Y="20,14\RLH\1\ SCRIPT DESCRIPTION *\\*,Enter short description - *                                   ",X="" D ^ZAA02GPOP Q
 ;
BAUD ; B - baud,parity,data bits
 S DV=MODEM I @ZAA02G@("OS")="MSM" U DV:(:::::::$S(B["N":2,B["O":5,1:9)*4096+($S($P(B,",",3)=7:5,1:9)*16)+$S(+B=300:7,+B=1200:9,+B=2400:11,+B=4800:12,+B=19200:14,+B=38400:15,1:13)) U 0 Q
 I @ZAA02G@("OS")="DTM" U DV:(SPEED=+B:PARITY=$S(B["N":"NONE",B["O":"ODD",1:"EVEN"):CHARBITS=$P(B,",",3)) U 0 Q
 I @ZAA02G@("OS")="PSM" S A=$S(+B=300:5,+B=1200:7,+B=2400:10,+B=4800:11,+B=19200:14,+B=38400:15,1:13) U DV:(:::A*16+A*8+$S(B["N":0,B["E":3,1:1)*4+$S($P(B,",",3)=7:2,1:3)*8) U 0 Q
 Q
CBAUD S Y="25,13\RLHW\1\ BAUD RATE CHANGES *\\*,  Speed      Parity     Data Bits   *,*,*,*, - Use Cursor Keys to change*, - Press SELECT key to execute change*, - Press EXIT to quit without changes",X=""
 D ^ZAA02GPOP W ZAA02G("RON") S %R=17,%C=30 W @ZAA02GP,"9600         N           8"
 S ZF=33,SP=6,PR=3,DT=2 F JJ=1:0:3 D:JJ=1 CSPEED D:JJ=2 CPAR D:JJ=3 CDATA S JJ=$S(ZF=35:JJ+1,ZF=57:4,ZF=36&(JJ=1):JJ,ZF=59:4,1:JJ-1)
 W ZAA02G("ROF") S %R=13,%C=1 W @ZAA02GP,ZAA02G("CS") I ZF'=57 S B=$P("300,600,1200,2400,4800,9600,19200,38400",",",SP)_","_$E("OEN",PR)_","_$E(78,DT) D BAUD
 K JJ,PAT,SP,PR,DT Q
CSPEED S %C=30,X=SP,PAT="300  ,600  ,1200  ,2400 ,4800 ,9600 ,19200,38400" D CCHG S SP=X Q
CPAR S %C=43,X=PR,PAT="O,E,N" D CCHG S PR=X Q
CDATA S %C=55,X=DT,PAT="7,8" D CCHG S DT=X Q
CCHG X @ZAA02G@("TERM-ON"),@ZAA02G@("ECHO-OFF") W ZAA02G("HI") F J=1:1 W @ZAA02GP,$P(PAT,",",X) R A#1 I A="" X ZAA02G("T") S ZF=$A(@ZAA02G@(.3,ZAA02G,0),$F(^(0),ZF)) S X=X+$S(ZF=33:1,X'>1:0,ZF=34:-1,1:0) S:$P(PAT,",",X)="" X=X-1 Q:"35,36,57,59"[ZF
 X @ZAA02G@("ECHO-ON"),@ZAA02G@("TERM-OFF") Q
 ;
SGLOBAL S SGLOBAL=B D OS^ZAA02GCOMM S TYPE="G",DIRECT="L" U 0 G CONNECT^ZAA02GCOMM
RGLOBAL S RGLOBAL=B D OS^ZAA02GCOMM S TYPE="G",DIRECT="R" U 0 G CONNECT^ZAA02GCOMM
SROUTINE F M=1:1:$L(B,",") S JJ=$P(B,",",M) S:JJ]"" RESTART(JJ)=""
 S RESTART="S UTIL=""RESTART""" D OS^ZAA02GCOMM S TYPE="R",DIRECT="L",(NM,RT)="" U 0 D CONNECT^ZAA02GCOMM K RESTART Q
