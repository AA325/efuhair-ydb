ZAA02GFAXH4 ;PG&A,ZAA02G-FAX,1.36,MH OVERLAY;21JAN94 7:55A
 ;Copyright (C) 1991-1994, Patterson, Gray and Associates Inc.
 ;
LINE S TXW=1728-MG-CVR I TXT'[XS S TXT=$TR(TXT,CA,CB) D LINEL F TXR=1:1:FR D LN1 H 0
 I TXT[XS D VIDEO S TXL=$L(TXT) D LINEE F TXR=1:1:FR D LN H 0
 I HP F FXL=FXL+1:1:12-TXR+FXL S @ZAA02GFAXS@(PG,FXL)=""
 Q
 ;
LINEL S TXL=$L(TXT) I '$D(TR) S TXW=TXW-(TXL*FC)
 E  F I=1:1:TXL S TXW=TXW-$A(TR,$A(TXT,I))
 I TXW<20 S TXT=$E(TXT,1,TXL-2),TXW=1728-MG-CVR G LINEL
 Q
LINEE S TXL=$L(TXT) Q:'TXL  I '$D(TR) S TXW=TXW-(TXL-$L(TXT,$C(0))+1*FC)
 E  S D=0,TXR=1 D CF F I=1:1:TXL X $S($A(TXT,I)=0:"D CF",1:"S TXW=TXW-$A(TR,$A(TXT,I))")
 I TXW<20 S TXT=$E(TXT,1,TXL-2),TXW=1728-MG-CVR G LINEE
 Q
 ;
LN S D=@OVR@(FXL+1),LX=$P(D,";",5,99),L=$P(D,";",4),W=MG D:$P(D,";",3)'="" SET S D=0 D:TXL CF
 F I=1:1:TXL S X=^ZAA02GFAXF(MF,.3,$A(NTY,I)*256+$A(NTX,I)),W=W+X D:X=0 CF I X["," S L=L_$S(W<32:wht(W),1:^ZAA02GFAXC(.1,W))_$P(X,",",2),W=$P(X,",",3) I $L(L)>16 S LX=LX_$C(B($E(L,1,4))+C($E(L,5,8)))_$C(B($E(L,9,12))+C($E(L,13,16))),L=$E(L,17,255)
 S W=W+TXD,FNT=FNT(0) G BLN:W>1728 S L=L_$S(W<32:wht(W),1:^ZAA02GFAXC(.1,W))_TRL
 S L=L_$E("00000000",1,-$L(L)#8) D LS,LE:LX[$C(16) S FXL=FXL+1,@ZAA02GFAXS@(PG,FXL)=LX Q
CF S FNT=FNT(D),D=D+1,NTX=$TR(TXT,AL,^ZAA02GFAXF(FNT,.1,TXR)),NTY=$TR(TXT,AL,^ZAA02GFAXF(FNT,.2,TXR)),TR=^ZAA02GFAXF(FNT,.4) Q
 ;
LN1 S D=@OVR@(FXL+1),LX=$P(D,";",5,99),L=$P(D,";",4),W=$P(D,";",2),TXD=TXW-D-W D:$P(D,";",3)'="" SET S D=0,NTX=$TR(TXT,AL,^ZAA02GFAXF(FNT,.1,TXR)),NTY=$TR(TXT,AL,^ZAA02GFAXF(FNT,.2,TXR))
 F I=1:1:TXL S X=^ZAA02GFAXF(MF,.3,$A(NTY,I)*256+$A(NTX,I)),W=W+X I X["," S L=L_$S(W<32:wht(W),1:^ZAA02GFAXC(.1,W))_$P(X,",",2),W=$P(X,",",3) I $L(L)>16 S LX=LX_$C(B($E(L,1,4))+C($E(L,5,8)))_$C(B($E(L,9,12))+C($E(L,13,16))),L=$E(L,17,255)
 S W=W+TXD G BLN:W>1728 S L=L_$S(W<32:wht(W),1:^ZAA02GFAXC(.1,W))_TRL
 S L=L_$E("00000000",1,-$L(L)#8) D LS,LE:LX[$C(16) S FXL=FXL+1,@ZAA02GFAXS@(PG,FXL)=LX Q
 ;
BLN S J=$D(@ZAA02GFAXS@(PG,FXL)) F FXL=FXL+1:1:FXL+FR S ^(FXL)=""
 Q
SET S I=CVR X $P(D,";",3) S TXW=TXW-CVR+I,TXD=TXD-CVR+I Q
LS F i=1:8:$L(L)\8*8 S LX=LX_$C(B($E(L,i,i+3))+C($E(L,i+4,i+7)))
 S L=$E(L,$L(L)>7*(i+8),255) Q
 ;
VIDEO S F=ZAA02G("gon"),C="",FNT(0)=FNT,(W,X)=0 F L=1:1:$L(TXT,F) S J=$P(TXT,F) D:J[XS V1 S C=C_$TR(J,CA,CB),J=$P($P(TXT,F,2,99),ZAA02G("gof")) D:J[XS V1 S TXT=$P(TXT,ZAA02G("gof"),2,99),C=C_$TR(J,CD,CE)
 S TXT=C Q
V1 I J[ZAA02G("fon") F T=2:1:$L(J,ZAA02G("fon")) S J=$P(J,ZAA02G("fon"))_" "_$P(J,ZAA02G("fof"),2,99)
 F T=1:1:$L(J,XS)-1 S I=$P(J,XS,2),E=$F(XL,$E(XS_I,1,XSL))\XSL S J=$P(J,XS)_$S(E:$C(0),1:"")_$E($P(J,XS,2,99),XSL,255) I E S X=$S(E=1:X>1*2+1,E=2:X>1*2,E=3:X#2+2,1:X#2),W=W+1,FNT(W)=FNT+X
 Q
LE F E=1:2:$L(LX,$C(16))-1*2 S $P(LX,$C(16),E)=$P(LX,$C(16),E)_$C(16)
 Q
 ;
