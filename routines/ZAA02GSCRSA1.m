ZAA02GSCRSA1 ;PG&A,ZAA02G-SCRIPT,2.10,STATS - AD HOC REPORS - 2;19FEB96 10:37A;;;08OCT97  11:24
 ;
PREP K Y,YY S DV=0 I TYPE=1 D PRP I DV="" W *13,ZAA02G("CL") G O^ZAA02GSCRSA
 S %R=23,%C=1 W @ZAA02GP,ZAA02G("CS"),*13 S II=$TR($H,",",";") K ^ZAA02GSCRSA(II) S D=II D DATE^ZAA02GSCRSA2,TIME^ZAA02GSCRSA2 S ^ZAA02GSCRSA(II)=D_"`"_TM_"`BUSY"
 S SS="I 1",(SS1,SS2,SS3)="I 1",SO=""
 S XY=$P("TR,SITEC,SITEC,PROV,TRANS",",",FILE)
 I $O(LIMX(2,""))]"" S SS1=SS1_","_"$D(LIMX(2,S2))"
 I $O(LIMX(3,""))]"" S SS3=SS3_","_"$D(LIMX(3,S4))"
 I $O(LIMX(4,""))]"" S SS2=SS2_","_"$D(LIMX(4,S3))"
 S SS5="S CC=CC+1",SS6=1
 S (L,S1,S2)=1,X=OR D S2 F X=1:1:15 I $D(PR(X)) D:OR'=X S2
 S NL=S1-1,(M,D)="" I SS6>1 S SS5(SS6)=SS5,SS5="F n=1:1:"_SS6_" X SS5(n)" F SS6=2:1:SS6 S SS5(SS6)="S "_$E(SS5(SS6),2,255)
 S:$E(SO)="," SO=$E(SO,2,99) S:$E(SO,$L(SO))="," SO=$E(SO,1,$L(SO)-1) S SO="D GET I R S M=$G(^ZAA02GSCRSA(II,"_SO_")) X SS5 S ^ZAA02GSCRSA(II,"_SO_")=M"
 I SO["DY" S SO="F DY=B3:1:B4 S (B1,B2)=DY "_SO
 F X="SS1","SS2","SS3" F J=1:1 S C=@X Q:C'["I 1,"  S @X=$P(@X,"I 1,")_"I "_$P(C,"I 1,",2,99)
 S %R=23,%C=1 W @ZAA02GP,"wait..."
 S DEV=DV G:DEV=0 PRINT
 S %R=24 W @ZAA02GP,ZAA02G("CL") S %C=30 W @ZAA02GP,"Queued to Print"
 F X="SS1","SS2","SS3","SS5","SS6","BM","EM","BD","ED","TYPE","FILE","NL","TITLE","TITLE2","DEV","XY","SO" S ^ZAA02GSCRSA(II,0,X)=@X
 I SS6>1 F X=1:1:SS6 S ^ZAA02GSCRSA(II,0.0001,X)=SS5(X)
 F A=2:1:4 I $D(LIMX(A)) S X="" F  S X=$O(LIMX(A,X)) Q:X=""  S ^ZAA02GSCRSA(II,.0002,A,X)=""
 H 1 D KILL G QUEUE
 ;
 ;
PRINT S (L1,L2,L3,L4,M1,M2,M3,M4,M5,M6,S2,S3,S4,CT)="",E="+0"
 S LF=$P(@ZAA02GSCR@("PARAM","BASIC"),"|",4),WF=$P(^("BASIC"),"|",2)
 S S1=BM-1 F CC=0:0 S S1=$O(@ZAA02GSCR@("STATS",S1)) Q:S1=""  Q:S1>EM  D S3 S $P(L1,1,$L(S1))=""
 S $P(^ZAA02GSCRSA(II),"`",6)=CT
 S A="" F J=1:1 S A=$O(^ZAA02GSCRSA(II,.001,A)) Q:A=""  S B=$P(^(A),",",3),$P(^(A),",",3)=$L(@B)+1
 K L1,L2,L3,L4,L5,M1,M2,M3,M4,M5,M6 D KILL
 G ^ZAA02GSCRSA2
KILL K SS1,SS2,SS3,SS4,SS5,SS6,SO,FILE,P,PR,LIMX Q
 ;
S3 S B3=1,B4=31 S:S1=BM B3=BD S:S1=EM B4=ED S B1=B3,B2=B4
 F J=0:0 S S2=$O(@ZAA02GSCR@("STATS",S1,S2)) Q:S2=""  X SS1 I  S $P(L2,1,$L(S2))="" D S4
 Q
S4 F J=0:0 S S3=$O(@ZAA02GSCR@("STATS",S1,S2,XY,S3)) Q:S3=""  X SS2 I  S $P(L3,1,$L(S3))="" F J=0:0 S S4=$O(@ZAA02GSCR@("STATS",S1,S2,XY,S3,S4)) Q:S4=""  I S4'="TOTAL" X SS3 I  S $P(L4,1,$L(S4))="" X SO
 Q
S2 G:FILE>4 S4 I FILE=2 S M=X+1,A=$S(X<5:$P("S3,S4,S1,S1_DY",",",X),1:"$$"_$P("CHAR,LINES,REPORTS,KEYBT,LINEH,CHARH,MACRO",",",X-4))
 I FILE=3 S M=X+1,A=$S(X<5:$P("S3,S4,S1,S1_DY",",",X),1:"$$"_$P("CHAR,LINES,REPORTS,KEYBT,LINEH,CHARH,MACRO",",",X-4))
 I 14[FILE S M=X,A=$S(X<6:$P("S3,S2,S4,S1,S1_DY",",",X),1:"$$"_$P("CHAR,LINES,REPORTS,KEYBT,LINEH,CHARH,MACRO",",",X-5))
 S ^ZAA02GSCRSA(II,.001,L)=X_","_PR(X)_","_$S(M<6:"L"_$E("32411",M)_",S D="_$E("ABCEF",S1),1:"M"_S2_",S D=$P(R,""\"","_S2_")") S:PR(X)["MM/DD" ^(L)=^(L)_" D MMDD" S:PR(X)["MM/YY" ^(L)=^(L)_" D MMYY" S L=L+1
 I M<6!(X=OR) S SO=SO_A_",",S1=S1+1 Q
 S:$L(SS5)>220 SS5(SS6)=SS5,SS6=SS6+1,SS5="" S SS5=SS5_",$P(M,""\"","_S2_")=$P(M,""\"","_S2_")+"_A_",$P(M"_S2_",1,$L($P(M,""\"","_S2_")))=""""",S2=S2+1 Q
S5 Q
DISP W !! N (FILE,OR,S1,PR,DTO,SS1,SS2,SS3,SS5,LIMX,TITLE,TITLE2,SO,EM,XY) W  R CCC Q
CHAR(X) Q @WF
LINES(X) Q @LF
REPORTS(X) Q R
KEYBT(X) Q $J(MN*.1,0,1)
LINEH(X) Q @("$J("_LF_"*600/(.01+MN),0,0)")
CHARH(X) Q @("$J("_WF_"*600/(.01+MN),0,0)")
MACRO(X) Q MC
GET S Z=@ZAA02GSCR@("STATS",S1,S2,XY,S3,S4,1),C="C="_$P(Z,"+",B1,B2)_E Q:$L(C)=2  S Z=^(2),L="L="_$P(Z,"+",B1,B2)_E,Z=^(3),W="W="_$P(Z,"+",B1,B2)_E,Z=^(4),B="B="_$P(Z,"+",B1,B2)_E,Z=^(5),S="S="_$P(Z,"+",B1,B2)_E,Z=^(6),R="R="_$P(Z,"+",B1,B2)_E
 S Z=^(7),MN="MN="_$P(Z,"+",B1,B2)_E,Z=$G(^(8)),MC="MC="_$P(Z,"+",B1,B2)_E,@C,@L,@W,@B,@S,@R,@MN,@MC Q
 ;
PRP N (ZAA02G,ZAA02GP,DV,ZAA02GSCR)
 S %R=24,%C=1 W @ZAA02GP,ZAA02G("CS")
 K Y S Y="10,24\QHP3UD\*\\\Terminal,Default Printer,Select Printer,Quit" D ^ZAA02GPOP S DV="" Q:X=4  I X=1 S DV=0 Q
 I X=2 S P=1 D DEFDV^ZAA02GSCRSP Q:DV'=""
 S P=2 D PR^ZAA02GSCRSP Q
 ;
QUEUE K Y S DOC="REPORTS" S Y("XECUTE")="D QUEUE1^ZAA02GSCRSA1",Y("ZAA02GSCR")=ZAA02GSCR,Y("II")=II
 D QUEUE^ZAA02GSCRSP K Y Q
QUEUE1 S A="" F J=1:1 S A=$O(@VDOC@(A)) Q:A=""  S B=A_"=@VDOC@(A)",@B
 S REPORT="AH",B(2)=11,B(3)=.5,B(4)=.9 D INIT^ZAA02GWPPC1,^ZAA02GSCRST9:49[(+DVP)
 S DONE=1,OFF=8*$S($D(LMG):0,1:1)
 S X="" F  S X=$O(^ZAA02GSCRSA(II,0,X)) Q:X=""  S @X=^(X)
 I SS6>1 F X=1:1:SS6 S SS5(X)=^ZAA02GSCRSA(II,.0001,X)
 S A="" F X=2:1:4 F  S A=$O(^ZAA02GSCRSA(II,.0002,X,A)) Q:A=""  S LIMX(X,A)=""
 G PRINT
 ;
